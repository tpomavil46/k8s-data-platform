apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: superset
  namespace: argocd
spec:
  project: default
  destination:
    server: https://kubernetes.default.svc
    namespace: superset

  source:
  repoURL: https://charts.bitnami.com/bitnami
  chart: superset
  targetRevision: 5.0.0
  helm:
    parameters: []
    values: |
      global:
        imageRegistry: ghcr.io
        security:
          allowInsecureImages: true
      image:
        registry: ghcr.io
        repository: bitnami/superset
        tag: "5.0.0"
        pullPolicy: IfNotPresent
      postgresql:
        enabled: false
        image:
          registry: ghcr.io
          repository: bitnami/postgresql
          tag: 16.4.0
        primary:
          image:
            registry: ghcr.io
            repository: bitnami/postgresql
            tag: 16.4.0
      redis:
        enabled: false
        image:
          registry: ghcr.io
          repository: bitnami/redis
          tag: 7.2.4
      externalDatabase:
        host: 172.16.0.20
        port: 5432
        user: superset
        database: superset
        passwordSecret: superset-externaldb
        passwordSecretKey: db-password
      web:
        initContainers: []
        waitForDB: false
        waitForRedis: false
        replicaCount: 1
        resources:
          requests:
            cpu: 10m
            memory: 128Mi
      worker:
        enabled: false
        initContainers: []
        waitForDB: false
        waitForRedis: false
      scheduler:
        enabled: false
        initContainers: []
        waitForDB: false
        waitForRedis: false

  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true