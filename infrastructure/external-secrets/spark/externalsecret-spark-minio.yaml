apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: superset-env
  namespace: superset
  annotations:
    argocd.argoproj.io/sync-wave: "-1"
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault
  target:
    name: superset-env
    template:
      type: Opaque
      data:
        SUPERSET_SECRET_KEY: "{{ .SECRET_KEY }}"
        SUPERSET_DATABASE_PASSWORD: "{{ .password }}"
        # Add these for the init container and Superset
        DB_HOST: "172.16.0.20"
        DB_PORT: "5432"
        DB_USER: "superset"
        DB_NAME: "superset"
        DB_PASS: "{{ .password }}"
  dataFrom:
    - extract:
        key: kv/superset